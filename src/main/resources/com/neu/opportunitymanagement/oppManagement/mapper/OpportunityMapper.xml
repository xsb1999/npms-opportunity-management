<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neu.opportunitymanagement.oppManagement.mapper.OpportunityMapper">

    <select id="getDeptInfoByEmpId" parameterType="String" resultType="DeptInfo">

        select distinct dept_id, dept_name
        from department, employee
        <where>
            emp_dept_id=dept_id
            <if test="emp_id != null">
                and emp_id=#{emp_id};
            </if>
        </where>

    </select>

    <select id="getEmpInfoByEmpIdAndDeptId" parameterType="String" resultType="EmpInfo">

        select distinct emp_id, emp_name
        from employee
        <where>
            emp_position_id in ("30000030","30000010")
            <if test="emp_id!=null">
                and emp_id=#{emp_id}
            </if>
            <if test="dept_id!=null">
                and emp_dept_id=#{dept_id}
            </if>
        </where>

    </select>

    <select id="getDeptNameById" parameterType="String" resultType="String">
        select dept_name from department where dept_id = #{dept_id};
    </select>

    <select id="getCusMgrNameById" parameterType="String" resultType="String">
        select emp_name from employee where emp_id = #{cusMgr_id};
    </select>

    <select id="getOppBelonging" parameterType="String" resultType="OppBelongingInfo">
        select * from c_bu
        <where>
            <if test="dept_name!=null">
               cbu_name =#{dept_name}
            </if>
        </where>
    </select>

    <select id="getOppSearchResult" parameterType="String" resultType="OppSearchResult">
        select * from opportunity where opp_customer_manager_id = #{emp_id}
    </select>

    <select id="getOppBelongingNameById" parameterType="String" resultType="String">
        select cbu_name from c_bu where cbu_id = #{oppb_id};
    </select>

    <select id="getEmpByDept" parameterType="String" resultType="EmpInfo">
        select distinct emp_id, emp_name
        from employee
        where emp_position_id in ("30000030","30000010") and emp_dept_id=#{dept_id}
    </select>


    <select id="getProductByType" parameterType="String" resultType="ProductInfo">
        select cpro_id, cpro_name
        from c_project_type_product_rel, c_product
        where cptpr_pro_id = cpro_id and cptpr_bus_id = #{type_id};
    </select>

    <select id="getTypeByProduct" parameterType="String" resultType="OppTypeInfo">
        select pso_id, pso_name
        from c_project_type_product_rel, c_project_sub_opp_type
        where cptpr_bus_id = pso_id and cptpr_pro_id = #{pro_id};
    </select>


    <select id="getOpportunity" parameterType="OppSearchCondition" resultType="OppSearchResult">
        select * from opportunity
        <where>
            <if test="oppId != null">
                opp_id like "%"#{oppId}"%"
            </if>
            <if test="oppName != null">
                and opp_name like "%"#{oppName}"%"
            </if>
            <if test="oppSalesDept != null">
                and opp_sales_dept = #{oppSalesDept}
            </if>
            <if test="oppSignTime1 != null and oppSignTime2 != null">
                and opp_sign_time between #{oppSignTime1} and #{oppSignTime2}
            </if>
            <if test="oppCustomerManagerId != null">
                and opp_customer_manager_id = #{oppCustomerManagerId}
            </if>
            <if test="oppBelonging != null">
                and opp_belonging = #{oppBelonging}
            </if>
            <if test="oppStatus != null">
                and opp_status = #{oppStatus}
            </if>
            <if test="oppPhase != null">
                and opp_phase = #{oppPhase}
            </if>
            <if test="oppType != null">
                and opp_type = #{oppType}
            </if>
            <if test="oppProduct != null">
                and opp_product = #{oppProduct}
            </if>
        </where>
    </select>







</mapper>
